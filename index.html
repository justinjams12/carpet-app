<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Choice Floors - Advanced Pro</title>
    <style>
        :root {
            --navy: #0f172a; --gold: #c5a059; --blueprint-bg: #1e293b;
            --glass: rgba(255, 255, 255, 0.95); --text: #334155; --danger: #ef4444;
        }
        body { font-family: 'Inter', sans-serif; margin: 0; background: #f1f5f9; color: var(--text); padding-bottom: 60px; }
        .app-shell { width: 100%; max-width: 480px; margin: auto; padding: 20px; box-sizing: border-box; }
        
        .tabs { display: flex; background: var(--navy); padding: 5px; border-radius: 15px; margin-bottom: 20px; }
        .tab-btn { flex: 1; padding: 12px; border: none; background: none; color: white; font-weight: 700; cursor: pointer; border-radius: 10px; opacity: 0.6; }
        .tab-btn.active { background: var(--gold); opacity: 1; }

        .view { display: none; }
        .view.active { display: block; }

        .live-result { background: var(--navy); color: white; border-radius: 24px; padding: 25px; text-align: center; margin-bottom: 20px; }
        .blueprint-card { background: var(--blueprint-bg); border-radius: 20px; padding: 15px; margin-bottom: 20px; border: 2px solid #334155; }
        #blueprint { width: 100%; height: 180px; }
        .seam-line { stroke: var(--danger); stroke-width: 2; stroke-dasharray: 4,4; }

        .card { background: var(--glass); border-radius: 20px; padding: 20px; margin-bottom: 15px; border: 1px solid white; position: relative; }
        .section-title { font-size: 0.75rem; font-weight: 800; color: var(--navy); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px; }
        
        /* Advanced Panel Styling */
        .advanced-trigger { 
            background: #f1f5f9; border: 1px dashed #cbd5e1; padding: 10px; border-radius: 10px; 
            font-size: 0.7rem; font-weight: 800; color: #64748b; text-align: center; 
            cursor: pointer; margin-bottom: 15px; text-transform: uppercase;
        }
        .advanced-content { display: none; padding-top: 10px; border-top: 1px solid #e2e8f0; margin-top: 10px; }
        .advanced-content.show { display: block; }

        .btn { width: 100%; padding: 15px; border-radius: 12px; border: none; font-weight: 800; cursor: pointer; margin-top: 10px; }
        .btn-add { background: var(--navy); color: white; }
        .btn-save { background: var(--gold); color: white; }
        .btn-delete { position: absolute; top: 15px; right: 15px; background: #fee2e2; color: var(--danger); border: none; padding: 5px 10px; border-radius: 8px; font-size: 0.7rem; font-weight: 700; cursor: pointer; }
        
        input, select { width: 100%; padding: 12px; border-radius: 10px; border: 1.5px solid #e2e8f0; margin-bottom: 10px; box-sizing: border-box; }
        label { font-size: 0.6rem; font-weight: 800; color: #64748b; text-transform: uppercase; margin-bottom: 4px; display: block; }
    </style>
</head>
<body>

<div class="app-shell">
    <header style="text-align:center; padding-bottom:15px;"><img src="choice-floors-logo.png" style="height:40px;"></header>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('workspace')">Workspace</button>
        <button class="tab-btn" onclick="switchTab('history')">Job History</button>
    </div>

    <div id="workspace" class="view active">
        <div class="live-result">
            <div id="displayTotal" style="font-size: 2.5rem; font-weight: 800; color: var(--gold);">$0.00</div>
            <div id="displaySub" style="font-size: 0.85rem;">0.00 Total Yards</div>
        </div>

        <div class="blueprint-card">
            <svg id="blueprint" viewBox="0 0 200 200">
                <rect id="roomRect" x="50" y="50" width="0" height="0" fill="rgba(197, 160, 89, 0.15)" stroke="#c5a059" stroke-width="1.5" />
                <g id="seamGroup"></g>
            </svg>
        </div>

        <div class="card">
            <div class="section-title">Room Measurement</div>
            <input type="text" id="roomName" placeholder="Room Name (e.g. Master Bed)">
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <div><label>Width (ft)</label><input type="number" id="wA" placeholder="0" oninput="drawBlueprint()"></div>
                <div><label>Length (ft)</label><input type="number" id="lB" placeholder="0" oninput="drawBlueprint()"></div>
            </div>

            <div class="advanced-trigger" onclick="toggleAdvanced()">⚙ Show Advanced Filters</div>
            <div class="advanced-content" id="advContent">
                <label>Roll Width</label>
                <select id="rollWidth" onchange="drawBlueprint()">
                    <option value="12">12' Standard</option>
                    <option value="15">15' Wide</option>
                    <option value="13.5">13.5' Specialty</option>
                </select>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <div><label>Waste %</label><input type="number" id="wastePct" value="10" oninput="drawBlueprint()"></div>
                    <div><label>Pattern Repeat (in)</label><input type="number" id="patternRepeat" value="0" oninput="drawBlueprint()"></div>
                </div>
                <label>Seam Overlap (inches)</label>
                <input type="number" id="seamOverlap" value="3" oninput="drawBlueprint()">
            </div>

            <button class="btn btn-add" onclick="addRoom()">+ Add to List</button>
        </div>

        <div class="card" id="roomListCard" style="display:none;">
            <div id="currentRooms"></div>
            <input type="text" id="jobName" placeholder="Customer/Job Name">
            <button class="btn btn-save" onclick="finalizeJob()">Finalize & Save Job</button>
        </div>
    </div>

    <div id="history" class="view">
        <div id="historyList"></div>
    </div>
</div>

<script>
    let currentJobRooms = [];

    function toggleAdvanced() {
        document.getElementById('advContent').classList.toggle('show');
    }

    function switchTab(tabId) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        event.currentTarget.classList.add('active');
        if(tabId === 'history') loadHistory();
    }

    function drawBlueprint() {
        let w = parseFloat(document.getElementById('wA').value) || 0;
        let l = parseFloat(document.getElementById('lB').value) || 0;
        let rW = parseFloat(document.getElementById('rollWidth').value);
        
        let rect = document.getElementById('roomRect');
        let seamGroup = document.getElementById('seamGroup');
        seamGroup.innerHTML = ""; 

        let scale = 150 / Math.max(w, l, 1);
        let drawW = w * scale; let drawL = l * scale;
        let startX = (200 - drawW) / 2; let startY = (200 - drawL) / 2;
        
        rect.setAttribute('width', drawW); rect.setAttribute('height', drawL);
        rect.setAttribute('x', startX); rect.setAttribute('y', startY);

        if (w > rW) {
            let numSeams = Math.floor((w - 0.01) / rW);
            for (let i = 1; i <= numSeams; i++) {
                let seamX = startX + (i * rW * scale);
                let line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", seamX); line.setAttribute("y1", startY);
                line.setAttribute("x2", seamX); line.setAttribute("y2", startY + drawL);
                line.setAttribute("class", "seam-line");
                seamGroup.appendChild(line);
            }
        }
        updateLiveTotals();
    }

    function updateLiveTotals() {
        let w = parseFloat(document.getElementById('wA').value) || 0;
        let l = parseFloat(document.getElementById('lB').value) || 0;
        if (w <= 0 || l <= 0) return;

        let rW = parseFloat(document.getElementById('rollWidth').value);
        let waste = 1 + (parseFloat(document.getElementById('wastePct').value) / 100);
        let repeat = (parseFloat(document.getElementById('patternRepeat').value) || 0) / 12;
        let overlap = (parseFloat(document.getElementById('seamOverlap').value) || 0) / 12;

        let strips = Math.ceil(w / rW);
        // Advanced Math: adding overlap to seams and repeat to length
        let effectiveLength = l + (strips > 1 ? overlap : 0) + repeat;
        let currentYards = (strips * rW * effectiveLength * waste) / 9;

        // Visual only update for current typing
        document.getElementById('displayTotal').innerText = `$${(currentYards * 35).toFixed(2)}`;
        document.getElementById('displaySub').innerText = `${currentYards.toFixed(2)} Yds (Current Room)`;
    }

    function addRoom() {
        let name = document.getElementById('roomName').value || "Room " + (currentJobRooms.length + 1);
        let w = parseFloat(document.getElementById('wA').value) || 0;
        let l = parseFloat(document.getElementById('lB').value) || 0;
        let rW = parseFloat(document.getElementById('rollWidth').value);
        let waste = 1 + (parseFloat(document.getElementById('wastePct').value) / 100);
        let repeat = (parseFloat(document.getElementById('patternRepeat').value) || 0) / 12;
        let overlap = (parseFloat(document.getElementById('seamOverlap').value) || 0) / 12;

        if(w <= 0 || l <= 0) return;

        let strips = Math.ceil(w / rW);
        let effectiveLength = l + (strips > 1 ? overlap : 0) + repeat;
        let yards = (strips * rW * effectiveLength * waste) / 9;

        currentJobRooms.push({ name, w, l, yards });
        updateRoomList();
        
        document.getElementById('roomName').value = "";
        document.getElementById('wA').value = "";
        document.getElementById('lB').value = "";
        drawBlueprint();
    }

    function updateRoomList() {
        let list = document.getElementById('currentRooms');
        let totalYards = currentJobRooms.reduce((sum, r) => sum + r.yards, 0);
        list.innerHTML = currentJobRooms.map(r => `<div class="room-tag">${r.name}: ${r.yards.toFixed(2)} Yds</div>`).join('');
        document.getElementById('roomListCard').style.display = currentJobRooms.length > 0 ? 'block' : 'none';
        document.getElementById('displayTotal').innerText = `$${(totalYards * 35).toFixed(2)}`;
        document.getElementById('displaySub').innerText = `${totalYards.toFixed(2)} Total Yards`;
    }

    function finalizeJob() {
        let name = document.getElementById('jobName').value || "Unnamed Project";
        let history = JSON.parse(localStorage.getItem('choiceFloorsHistory') || '[]');
        history.unshift({ name, date: new Date().toLocaleDateString(), rooms: currentJobRooms, total: document.getElementById('displayTotal').innerText });
        localStorage.setItem('choiceFloorsHistory', JSON.stringify(history));
        currentJobRooms = []; updateRoomList();
        alert("Job Saved!");
    }

    function loadHistory() {
        let history = JSON.parse(localStorage.getItem('choiceFloorsHistory') || '[]');
        let list = document.getElementById('historyList');
        if(history.length === 0) { list.innerHTML = "<p style='text-align:center; opacity:0.5;'>No projects found.</p>"; return; }
        list.innerHTML = history.map((h, i) => `
            <div class="card">
                <button class="btn-delete" onclick="deleteJob(${i})">Delete</button>
                <div style="font-weight:800; color:var(--navy);">${h.name}</div>
                <div style="font-size:0.7rem; color:#94a3b8; margin-bottom:10px;">${h.date} • ${h.total}</div>
                ${h.rooms.map(r => `<div style="font-size:0.8rem; opacity:0.8;">- ${r.name}: ${r.yards.toFixed(2)} Yds</div>`).join('')}
            </div>
        `).join('');
    }

    function deleteJob(index) {
        if(confirm("Delete this project?")) {
            let history = JSON.parse(localStorage.getItem('choiceFloorsHistory') || '[]');
            history.splice(index, 1);
            localStorage.setItem('choiceFloorsHistory', JSON.stringify(history));
            loadHistory();
        }
    }
</script>
</body>
</html>