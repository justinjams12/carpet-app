<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Choice Floors - Project Manager</title>
    <style>
        :root {
            --navy: #0f172a; --gold: #c5a059; --blueprint-bg: #1e293b;
            --glass: rgba(255, 255, 255, 0.95); --text: #334155; --danger: #ef4444;
        }
        body { font-family: 'Inter', sans-serif; margin: 0; background: #f1f5f9; color: var(--text); padding-bottom: 60px; }
        .app-shell { width: 100%; max-width: 480px; margin: auto; padding: 20px; box-sizing: border-box; }
        
        .tabs { display: flex; background: var(--navy); padding: 5px; border-radius: 15px; margin-bottom: 20px; }
        .tab-btn { flex: 1; padding: 12px; border: none; background: none; color: white; font-weight: 700; cursor: pointer; border-radius: 10px; opacity: 0.6; }
        .tab-btn.active { background: var(--gold); opacity: 1; }

        .view { display: none; }
        .view.active { display: block; }

        .live-result { background: var(--navy); color: white; border-radius: 24px; padding: 25px; text-align: center; margin-bottom: 20px; }
        .blueprint-card { background: var(--blueprint-bg); border-radius: 20px; padding: 15px; margin-bottom: 20px; border: 2px solid #334155; }
        #blueprint { width: 100%; height: 180px; }
        .seam-line { stroke: var(--danger); stroke-width: 2; stroke-dasharray: 4,4; }

        .card { background: var(--glass); border-radius: 20px; padding: 20px; margin-bottom: 15px; border: 1px solid white; position: relative; }
        .section-title { font-size: 0.75rem; font-weight: 800; color: var(--navy); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px; }
        
        .btn { width: 100%; padding: 15px; border-radius: 12px; border: none; font-weight: 800; cursor: pointer; margin-top: 10px; }
        .btn-add { background: #e2e8f0; color: var(--navy); }
        .btn-save { background: var(--gold); color: white; }
        
        /* Delete Button Styles */
        .btn-delete { 
            position: absolute; top: 15px; right: 15px; 
            background: #fee2e2; color: var(--danger); 
            border: none; padding: 5px 10px; border-radius: 8px; 
            font-size: 0.7rem; font-weight: 700; cursor: pointer;
        }
        .btn-clear-all { background: none; color: #94a3b8; border: 1px solid #cbd5e1; font-size: 0.7rem; margin-top: 30px; }
        
        .room-tag { background: #f8fafc; padding: 10px; border-radius: 8px; margin-bottom: 8px; border-left: 4px solid var(--gold); font-size: 0.85rem; }
    </style>
</head>
<body>

<div class="app-shell">
    <header style="text-align:center; padding-bottom:15px;"><img src="choice-floors-logo.png" style="height:40px;"></header>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('workspace')">Workspace</button>
        <button class="tab-btn" onclick="switchTab('history')">Job History</button>
    </div>

    <div id="workspace" class="view active">
        <div class="live-result">
            <div id="displayTotal" style="font-size: 2.5rem; font-weight: 800; color: var(--gold);">$0.00</div>
            <div id="displaySub" style="font-size: 0.85rem;">0.00 Total Yards</div>
        </div>

        <div class="blueprint-card">
            <svg id="blueprint" viewBox="0 0 200 200">
                <rect id="roomRect" x="50" y="50" width="0" height="0" fill="rgba(197, 160, 89, 0.15)" stroke="#c5a059" stroke-width="1.5" />
                <g id="seamGroup"></g>
            </svg>
        </div>

        <div class="card">
            <div class="section-title">Add Room</div>
            <input type="text" id="roomName" placeholder="Room Name" style="width:100%; padding:12px; margin-bottom:10px; border-radius:10px; border:1.5px solid #e2e8f0;">
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <input type="number" id="wA" placeholder="Width" oninput="drawBlueprint()" style="padding:12px; border-radius:10px; border:1.5px solid #e2e8f0;">
                <input type="number" id="lB" placeholder="Length" oninput="drawBlueprint()" style="padding:12px; border-radius:10px; border:1.5px solid #e2e8f0;">
            </div>
            <button class="btn btn-add" onclick="addRoom()">+ Add to List</button>
        </div>

        <div class="card" id="roomListCard" style="display:none;">
            <div id="currentRooms"></div>
            <input type="text" id="jobName" placeholder="Customer/Job Name" style="width:100%; padding:12px; margin-top:10px; border-radius:10px; border:1.5px solid #e2e8f0;">
            <button class="btn btn-save" onclick="finalizeJob()">Finalize & Save Job</button>
        </div>
    </div>

    <div id="history" class="view">
        <div id="historyList"></div>
        <button class="btn btn-clear-all" onclick="clearAllHistory()">Permanently Clear All History</button>
    </div>
</div>

<script>
    let currentJobRooms = [];
    let rollW = 12;

    function switchTab(tabId) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        event.currentTarget.classList.add('active');
        if(tabId === 'history') loadHistory();
    }

    function drawBlueprint() {
        let w = parseFloat(document.getElementById('wA').value) || 0;
        let l = parseFloat(document.getElementById('lB').value) || 0;
        let rect = document.getElementById('roomRect');
        let seamGroup = document.getElementById('seamGroup');
        seamGroup.innerHTML = ""; 
        let scale = 150 / Math.max(w, l, 1);
        let drawW = w * scale; let drawL = l * scale;
        let startX = (200 - drawW) / 2; let startY = (200 - drawL) / 2;
        rect.setAttribute('width', drawW); rect.setAttribute('height', drawL);
        rect.setAttribute('x', startX); rect.setAttribute('y', startY);
        if (w > rollW) {
            let numSeams = Math.floor((w - 0.01) / rollW);
            for (let i = 1; i <= numSeams; i++) {
                let seamX = startX + (i * rollW * scale);
                let line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", seamX); line.setAttribute("y1", startY);
                line.setAttribute("x2", seamX); line.setAttribute("y2", startY + drawL);
                line.setAttribute("class", "seam-line");
                seamGroup.appendChild(line);
            }
        }
    }

    function addRoom() {
        let name = document.getElementById('roomName').value || "Room " + (currentJobRooms.length + 1);
        let w = parseFloat(document.getElementById('wA').value) || 0;
        let l = parseFloat(document.getElementById('lB').value) || 0;
        if(w <= 0 || l <= 0) return;
        let yards = (Math.ceil(w / rollW) * rollW * l) / 9;
        currentJobRooms.push({ name, w, l, yards });
        updateRoomList();
        document.getElementById('roomName').value = "";
        document.getElementById('wA').value = "";
        document.getElementById('lB').value = "";
        drawBlueprint();
    }

    function updateRoomList() {
        let list = document.getElementById('currentRooms');
        let totalYards = currentJobRooms.reduce((sum, r) => sum + r.yards, 0);
        list.innerHTML = currentJobRooms.map(r => `<div class="room-tag">${r.name}: ${r.yards.toFixed(2)} Yds</div>`).join('');
        document.getElementById('roomListCard').style.display = currentJobRooms.length > 0 ? 'block' : 'none';
        document.getElementById('displayTotal').innerText = `$${(totalYards * 35).toFixed(2)}`;
        document.getElementById('displaySub').innerText = `${totalYards.toFixed(2)} Total Yards`;
    }

    function finalizeJob() {
        let name = document.getElementById('jobName').value || "Unnamed Project";
        let history = JSON.parse(localStorage.getItem('choiceFloorsHistory') || '[]');
        history.unshift({ name, date: new Date().toLocaleDateString(), rooms: currentJobRooms, total: document.getElementById('displayTotal').innerText });
        localStorage.setItem('choiceFloorsHistory', JSON.stringify(history));
        currentJobRooms = []; updateRoomList();
        alert("Job Saved!");
    }

    function deleteJob(index) {
        if(confirm("Delete this project permanently?")) {
            let history = JSON.parse(localStorage.getItem('choiceFloorsHistory') || '[]');
            history.splice(index, 1);
            localStorage.setItem('choiceFloorsHistory', JSON.stringify(history));
            loadHistory();
        }
    }

    function clearAllHistory() {
        if(confirm("This will erase ALL previous projects. Are you sure?")) {
            localStorage.removeItem('choiceFloorsHistory');
            loadHistory();
        }
    }

    function loadHistory() {
        let history = JSON.parse(localStorage.getItem('choiceFloorsHistory') || '[]');
        let list = document.getElementById('historyList');
        if(history.length === 0) { list.innerHTML = "<p style='text-align:center; opacity:0.5;'>No projects found.</p>"; return; }
        list.innerHTML = history.map((h, i) => `
            <div class="card">
                <button class="btn-delete" onclick="deleteJob(${i})">Delete</button>
                <div style="font-weight:800; color:var(--navy);">${h.name}</div>
                <div style="font-size:0.7rem; color:#94a3b8; margin-bottom:10px;">${h.date} â€¢ ${h.total}</div>
                ${h.rooms.map(r => `<div style="font-size:0.8rem; opacity:0.8;">- ${r.name}: ${r.w}x${r.l}</div>`).join('')}
            </div>
        `).join('');
    }
</script>
</body>
</html>